import{e as y,j as e,r as u,T as l,P as b,B as g,Q as C,f as j,I as v,u as T,c as f,U as I,C as S}from"./index-CKLgkD1v.js";import{L as $}from"./LocationOn-qhTYfCyv.js";import{I as A}from"./Info-IZnw5zVA.js";import{T as L,a as N,b as w,c as p,d as D}from"./TableRow-DM6qFwiW.js";import{T as i}from"./TableCell-BtnOls6d.js";import{C as h}from"./Chip-DfvBT8qY.js";import{A as k}from"./Alert-DDDj34Iz.js";const B=y([e.jsx("path",{fillRule:"evenodd",d:"M16.67 13.13C18.04 14.06 19 15.32 19 17v3h4v-3c0-2.18-3.57-3.47-6.33-3.87"},"0"),e.jsx("circle",{cx:"9",cy:"8",r:"4",fillRule:"evenodd"},"1"),e.jsx("path",{fillRule:"evenodd",d:"M15 12c2.21 0 4-1.79 4-4s-1.79-4-4-4c-.47 0-.91.1-1.33.24C14.5 5.27 15 6.58 15 8s-.5 2.73-1.33 3.76c.42.14.86.24 1.33.24m-6 1c-2.67 0-8 1.34-8 4v3h16v-3c0-2.66-5.33-4-8-4"},"2")]),E=({schedules:o})=>{console.log("[TaughtCourseList] Received schedules:",o);const a=t=>{const s=["一","二","三","四","五","六","日"],r=t.weekDay&&t.weekDay>=1&&t.weekDay<=7?`周${s[t.weekDay-1]}`:"待定",d=t.startTime&&t.endTime?`${t.startTime.substring(0,5)}-${t.endTime.substring(0,5)}`:"时间待定",c=t.weeks||"周次待定";return`${r} ${d} [${c}]`},n=u.useMemo(()=>Array.isArray(o)?o.reduce((t,s)=>{if(!s||typeof s.courseId!="number")return console.warn("[TaughtCourseList] Invalid schedule item found:",s),t;const r=s.courseId.toString();return t[r]||(t[r]={courseName:s.courseName||"未知课程",courseCode:s.courseCode||"N/A",credit:s.credit,slots:[]}),t[r].slots.push(s),t},{}):(console.error("[TaughtCourseList] schedules prop is not an array:",o),{}),[o]);return console.log("[TaughtCourseList] Grouped courses:",n),!o||o.length===0?e.jsx(l,{sx:{mt:3,textAlign:"center",color:"text.secondary"},children:"本学期您没有教学安排。"}):Object.keys(n).length===0&&o.length>0?e.jsx(l,{sx:{mt:3,textAlign:"center",color:"text.secondary"},children:"无法解析教学安排数据。"}):e.jsx(L,{component:b,elevation:3,sx:{mt:2},children:e.jsxs(N,{sx:{minWidth:750},"aria-label":"我的教学安排",children:[e.jsx(w,{sx:{backgroundColor:"grey.100"},children:e.jsxs(p,{children:[e.jsx(i,{sx:{fontWeight:"bold"},children:"课程名称 / 代码 (学分)"}),e.jsx(i,{sx:{fontWeight:"bold"},children:"上课安排 (时间/地点/周次)"}),e.jsx(i,{align:"center",sx:{fontWeight:"bold"},children:"已选/容量"}),e.jsx(i,{sx:{fontWeight:"bold"},children:"操作"})]})}),e.jsx(D,{children:Object.values(n).map(t=>e.jsxs(p,{hover:!0,children:[e.jsxs(i,{component:"th",scope:"row",children:[e.jsx(l,{variant:"subtitle2",fontWeight:"medium",children:t.courseName}),e.jsxs(l,{variant:"caption",color:"text.secondary",children:[t.courseCode," ",t.credit!==void 0?`(${t.credit}学分)`:""]})]}),e.jsx(i,{children:t.slots.map((s,r)=>e.jsxs(g,{sx:{mb:t.slots.length>1?1:0,pb:t.slots.length>1?1:0,borderBottom:t.slots.length>1?"1px dashed #eee":"none","&:last-child":{borderBottom:"none",mb:0,pb:0}},children:[e.jsx(h,{icon:e.jsx(C,{fontSize:"small"}),label:a(s),size:"small",variant:"outlined",sx:{mb:.5}}),e.jsx("br",{}),e.jsx(h,{icon:e.jsx($,{fontSize:"small"}),label:`${s.classroomBuilding||"N/A"} ${s.classroomRoomNumber||"N/A"}`,size:"small",variant:"outlined"})]},`${s.scheduleId}-${r}`))}),e.jsx(i,{align:"center",children:t.slots.map((s,r)=>e.jsx(g,{sx:{mb:.5},children:e.jsx(j,{title:s.maxCapacity===void 0?"名额信息暂无":`课程班容量 ${s.maxCapacity}, 已选 ${s.enrolledCount??0}`,children:e.jsx("span",{children:e.jsx(h,{icon:e.jsx(B,{fontSize:"small"}),label:s.maxCapacity===void 0?"N/A":`${s.enrolledCount??"0"}/${s.maxCapacity}`,size:"small",color:s.maxCapacity!==void 0&&(s.enrolledCount??0)>=s.maxCapacity?"error":"default",disabled:s.maxCapacity===void 0})})})},`enroll-${s.scheduleId}-${r}`))}),e.jsx(i,{children:e.jsx(j,{title:"查看学生名单 (待实现)",children:e.jsx("span",{children:e.jsx(v,{size:"small",disabled:!0,children:e.jsx(A,{})})})})})]},t.courseCode+t.courseName))})]})})},F=()=>{const o=T(),{teacherSchedules:a,isLoadingSchedules:n,error:t}=f(x=>x.requests),{currentSemester:s,isLoadingInitialData:r,error:d}=f(x=>x.timetable);u.useEffect(()=>{console.log("[MyCoursesPage] Effect triggered. Current states:"),console.log("  - currentSemester:",s),console.log("  - teacherSchedules count:",a.length),console.log("  - isLoadingSchedules:",n),console.log("  - isLoadingTimetableData (for semester):",r)},[s,a.length,n,r]),u.useEffect(()=>{s&&s.semesterId?(a.length===0&&!n||t)&&(console.log(`[MyCoursesPage] Dispatching fetchTeacherSchedulesForRequests for semesterId: ${s.semesterId}`),o(I(s.semesterId))):r||console.warn("[MyCoursesPage] currentSemester is null and timetable is not loading. Cannot fetch teacher schedules.")},[o,s,a.length,n,t]);const c=t||(s?null:d),m=r||s&&n;return e.jsxs(b,{sx:{p:{xs:2,sm:3},minHeight:"70vh"},children:[e.jsxs(l,{variant:"h4",component:"h1",gutterBottom:!0,children:["我的教学安排 ",s?`(${s.semesterName})`:""]}),m&&e.jsxs(g,{sx:{display:"flex",justifyContent:"center",my:5},children:[e.jsx(S,{}),e.jsx(l,{sx:{ml:2},children:r?"加载学期信息中...":"加载教学安排中..."})]}),c&&!m&&e.jsxs(k,{severity:"error",sx:{mt:2},children:["加载教学安排失败: ",c,d&&s&&" (学期信息可能也存在问题)"]}),!m&&!c&&s&&(a.length>0?e.jsx(E,{schedules:a}):e.jsx(l,{sx:{mt:3,textAlign:"center",color:"text.secondary"},children:"本学期您暂无教学安排。"})),!s&&!m&&!c&&e.jsx(l,{sx:{mt:3,textAlign:"center",color:"text.secondary"},children:"学期信息加载中或加载失败，无法显示教学安排。"})]})};export{F as default};
