import{e as y,j as s,T as o,P as j,f as h,h as d,B as l,u as g,c as f,r as b,$ as x,d as v,C as I}from"./index-CKLgkD1v.js";import{R as C}from"./Refresh-BWjUhbNv.js";import{C as T}from"./CheckCircleOutline-B9_rkMsl.js";import{C as R}from"./CancelOutlined-BJumekxO.js";import{S as k,E as $}from"./EventAvailable-D8fnVWep.js";import{T as S,a as M,b as W,c as p,d as D}from"./TableRow-DM6qFwiW.js";import{T as n}from"./TableCell-BtnOls6d.js";import{C as a}from"./Chip-DfvBT8qY.js";import{A}from"./Alert-DDDj34Iz.js";const H=y(s.jsx("path",{d:"M17 12c-2.76 0-5 2.24-5 5s2.24 5 5 5 5-2.24 5-5-2.24-5-5-5m1.65 7.35L16.5 17.2V14h1v2.79l1.85 1.85zM18 3h-3.18C14.4 1.84 13.3 1 12 1s-2.4.84-2.82 2H6c-1.1 0-2 .9-2 2v15c0 1.1.9 2 2 2h6.11c-.59-.57-1.07-1.25-1.42-2H6V5h2v3h8V5h2v5.08c.71.1 1.38.31 2 .6V5c0-1.1-.9-2-2-2m-6 2c-.55 0-1-.45-1-1s.45-1 1-1 1 .45 1 1-.45 1-1 1"})),z=({requests:t})=>{if(!t||t.length===0)return s.jsx(o,{sx:{mt:3,textAlign:"center",color:"text.secondary"},children:"暂无申请记录。"});const c=e=>{switch(e){case"pending":return s.jsx(a,{icon:s.jsx(H,{}),label:"待审批",size:"small",color:"warning"});case"approved":return s.jsx(a,{icon:s.jsx(T,{}),label:"已批准",size:"small",color:"success"});case"rejected":return s.jsx(a,{icon:s.jsx(R,{}),label:"已拒绝",size:"small",color:"error"});default:return s.jsx(a,{label:e,size:"small"})}},r=e=>e.requestType==="schedule_change"?s.jsxs(l,{children:[s.jsxs(o,{variant:"caption",display:"block",children:[s.jsx("strong",{children:"原："}),e.originalScheduleInfo||`课程ID ${e.originalScheduleId}`]}),s.jsxs(o,{variant:"caption",display:"block",color:"primary",children:[s.jsx("strong",{children:"新："}),`周${["一","二","三","四","五","六","日"][e.proposedWeekDay-1]} 第${e.proposedSectionId}节 `,`@ ${e.proposedClassroomInfo||`教室ID ${e.proposedClassroomId}`} [${e.proposedWeeks}]`]}),s.jsxs(o,{variant:"caption",display:"block",children:[s.jsx("strong",{children:"原因："}),e.reason]})]}):e.requestType==="exam_arrangement"?s.jsxs(l,{children:[s.jsxs(o,{variant:"caption",display:"block",children:[s.jsx("strong",{children:"类型："}),e.examType]}),s.jsxs(o,{variant:"caption",display:"block",children:[s.jsx("strong",{children:"日期："}),d(e.proposedDate||"","yyyy-MM-dd")]}),s.jsxs(o,{variant:"caption",display:"block",color:"primary",children:[s.jsx("strong",{children:"安排："}),`第${e.proposedSectionId}节, ${e.proposedDuration}分钟 @ ${e.proposedClassroomInfo||`教室ID ${e.proposedClassroomId}`}`]}),s.jsxs(o,{variant:"caption",display:"block",children:[s.jsx("strong",{children:"原因："}),e.examReason||e.reason]})]}):s.jsx(o,{variant:"caption",children:"未知请求详情"});return s.jsx(S,{component:j,elevation:3,sx:{mt:2},children:s.jsxs(M,{sx:{minWidth:800},"aria-label":"我的申请记录",children:[s.jsx(W,{sx:{backgroundColor:"grey.100"},children:s.jsxs(p,{children:[s.jsx(n,{sx:{fontWeight:"bold"},children:"类型"}),s.jsx(n,{sx:{fontWeight:"bold"},children:"申请课程"}),s.jsx(n,{sx:{fontWeight:"bold",minWidth:280},children:"申请详情"}),s.jsx(n,{sx:{fontWeight:"bold"},children:"状态"}),s.jsx(n,{sx:{fontWeight:"bold"},children:"申请日期"}),s.jsx(n,{sx:{fontWeight:"bold"},children:"处理日期"}),s.jsx(n,{sx:{fontWeight:"bold"},children:"处理人/备注"})]})}),s.jsx(D,{children:t.map(e=>s.jsxs(p,{hover:!0,children:[s.jsx(n,{children:s.jsx(h,{title:e.requestType==="schedule_change"?"调课申请":"考试安排申请",children:s.jsx(a,{icon:e.requestType==="schedule_change"?s.jsx(k,{}):s.jsx($,{}),label:e.requestType==="schedule_change"?"调课":"考试",size:"small",color:e.requestType==="schedule_change"?"info":"secondary",variant:"outlined"})})}),s.jsx(n,{children:e.courseName||`(课程ID: ${e.courseId||e.originalScheduleId})`}),s.jsx(n,{children:r(e)}),s.jsx(n,{children:c(e.status)}),s.jsx(n,{children:d(e.requestedAt,"yyyy-MM-dd HH:mm")}),s.jsx(n,{children:e.processedAt?d(e.processedAt,"yyyy-MM-dd HH:mm"):"-"}),s.jsxs(n,{children:[e.approverInfo||"",e.status==="rejected"&&e.rejectReason&&s.jsx(h,{title:`拒绝原因: ${e.rejectReason}`,children:s.jsx(o,{variant:"caption",display:"block",color:"error.main",children:"(含原因)"})})]})]},e.requestId))})]})})},F=()=>{const t=g(),{myRequests:c,isLoadingMyRequests:r,error:e,hasLoadedMyRequests:i}=f(u=>u.requests);b.useEffect(()=>{!i&&!r&&t(x())},[t,i,r]);const m=()=>{t(x())};return s.jsxs(j,{sx:{p:{xs:2,sm:3},minHeight:"70vh"},children:[s.jsxs(l,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:2},children:[s.jsx(o,{variant:"h4",component:"h1",gutterBottom:!0,children:"我的申请记录"}),s.jsx(v,{variant:"outlined",startIcon:s.jsx(C,{}),onClick:m,disabled:r,children:"刷新"})]}),r&&!i&&s.jsxs(l,{sx:{display:"flex",justifyContent:"center",my:5},children:[s.jsx(I,{})," ",s.jsx(o,{sx:{ml:2},children:"加载申请记录中..."})]}),e&&!r&&s.jsxs(A,{severity:"error",sx:{mt:2},children:["加载申请记录失败: ",e]}),i&&!r&&!e&&s.jsx(z,{requests:c}),i&&!r&&!e&&c.length===0&&s.jsx(o,{sx:{mt:3,textAlign:"center",color:"text.secondary"},children:"您还没有提交过任何申请。"})]})};export{F as default};
