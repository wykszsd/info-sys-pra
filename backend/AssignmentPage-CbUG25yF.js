import{r as p,j as e,B as w,T as y,a0 as E,M as k,d as N,C as B,u as M,c as A,a1 as P,a2 as R,a3 as F,P as V,a4 as _}from"./index-CKLgkD1v.js";import{u as q,C,s as H,z as I}from"./index-Bf-gyStQ.js";import{G as j}from"./Grid-CW7wBfPk.js";import{T as O,F as T}from"./TextField-CAILEkKj.js";import{F as z,I as W,S as G,T as J}from"./Select-JmEIo2-X.js";import{A as $}from"./Alert-DDDj34Iz.js";import{S as K}from"./Snackbar-HS5EKS66.js";const L=E(J)(({theme:t})=>{var h,o,l,c,d,u,a,s,b,r,n,i,x,g,v,f,m,S;return` // theme 可以从 props 中解构，如果 styled 来自 @mui/material/styles
  width: 100%;
  font-family: inherit;
  font-size: 1rem;
  padding: 8.5px 14px; // 模仿 TextField 的 padding
  border-radius: ${((h=t.shape)==null?void 0:h.borderRadius)||4}px; // 使用 theme 的 borderRadius
  border: 1px solid ${((o=t.palette)==null?void 0:o.mode)==="dark"?(l=t.palette)==null?void 0:l.grey[700]:(c=t.palette)==null?void 0:c.grey[400]};
  &:hover {
    border-color: ${(u=(d=t.palette)==null?void 0:d.text)==null?void 0:u.primary};
  }
  &:focus {
    outline: none;
    border-color: ${(s=(a=t.palette)==null?void 0:a.primary)==null?void 0:s.main};
    box-shadow: 0 0 0 1px ${(r=(b=t.palette)==null?void 0:b.primary)==null?void 0:r.main};
  }
  &::placeholder {
    color: ${(i=(n=t.palette)==null?void 0:n.text)==null?void 0:i.disabled};
  }
  // 处理 disabled 状态
  &:disabled {
    background-color: ${(g=(x=t.palette)==null?void 0:x.action)==null?void 0:g.disabledBackground};
    color: ${(f=(v=t.palette)==null?void 0:v.text)==null?void 0:f.disabled};
    border-color: ${(S=(m=t.palette)==null?void 0:m.action)==null?void 0:S.disabled};
  }
`}),Q=I.object({title:I.string().min(3,"标题至少3个字符").max(100,"标题过长"),content:I.string().min(10,"内容至少10个字符").max(2e3,"内容过长"),courseId:I.number({invalid_type_error:"请选择一个有效的课程",required_error:"请选择目标课程"}).positive("请选择目标课程")}),U=({teacherCoursesForDropdown:t,onSubmitAssignment:h,isSubmitting:o,isLoadingCourses:l,initialData:c})=>{const{control:d,handleSubmit:u,reset:a,formState:{errors:s}}=q({resolver:H(Q),defaultValues:c||{title:"",content:"",courseId:void 0}});p.useEffect(()=>{a(c||{title:"",content:"",courseId:void 0})},[c,a]);const b=async r=>{const n={title:r.title,content:r.content,courseId:r.courseId};await h(n)};return e.jsx(w,{component:"form",onSubmit:u(b),noValidate:!0,sx:{mt:1},children:e.jsxs(j,{container:!0,spacing:2.5,children:[" ",e.jsxs(j,{size:{xs:12},children:[" ",e.jsx(C,{name:"title",control:d,render:({field:r})=>{var n;return e.jsx(O,{...r,label:"通知标题",fullWidth:!0,required:!0,error:!!s.title,helperText:(n=s.title)==null?void 0:n.message,disabled:o})}})]}),e.jsx(j,{size:{xs:12},children:e.jsxs(z,{fullWidth:!0,error:!!s.content,children:[" ",e.jsx(y,{component:"label",htmlFor:"assignment-content-textarea",gutterBottom:!0,sx:{mb:.5,fontSize:"0.8rem",color:s.content?"error.main":"text.secondary",display:"block"},children:"作业内容/通知详情 *"}),e.jsx(C,{name:"content",control:d,render:({field:r})=>e.jsx(L,{id:"assignment-content-textarea",minRows:6,placeholder:"输入作业内容、要求、截止日期等...",...r,disabled:o,style:s.content?{borderColor:"red"}:{}})}),s.content&&e.jsx(T,{error:!0,children:s.content.message})]})}),e.jsx(j,{size:{xs:12,sm:8,md:6},children:e.jsx(C,{name:"courseId",control:d,render:({field:r})=>e.jsxs(z,{fullWidth:!0,required:!0,error:!!s.courseId,size:"small",disabled:l||o,children:[e.jsx(W,{id:"courseId-select-label",children:"目标课程"}),e.jsxs(G,{labelId:"courseId-select-label",...r,value:r.value===void 0?"":r.value,label:"目标课程",onChange:n=>{const i=n.target.value;if(typeof i=="string"&&i==="")r.onChange(void 0);else if(typeof i=="number")r.onChange(i);else{const x=Number(i);!isNaN(x)&&String(i).trim()!==""?r.onChange(x):r.onChange(void 0)}},children:[e.jsx(k,{value:"",children:e.jsx("em",{children:"请选择课程"})}),t.map(n=>e.jsxs(k,{value:n.courseId,children:[n.courseName," (",n.courseCode,")"]},n.courseId))]}),s.courseId&&e.jsx(T,{error:!0,children:s.courseId.message}),l&&t.length===0&&e.jsx(y,{variant:"caption",sx:{pl:2,pt:.5,color:"text.secondary"},children:"加载课程中..."}),!l&&t.length===0&&e.jsx(y,{variant:"caption",sx:{pl:2,pt:.5,color:"text.secondary"},children:"课程列表为空或您没有教授的课程。"})]})})}),e.jsxs(j,{size:{xs:12},sx:{textAlign:"right",mt:2},children:[" ",e.jsx(N,{type:"submit",variant:"contained",disabled:o||l,startIcon:o?e.jsx(B,{size:20,color:"inherit"}):null,children:"发布通知"})]})]})})},re=()=>{const t=M(),{teacherCourses:h,isLoadingCourses:o,isSubmitting:l,submitSuccess:c,error:d,currentSemesterIdForCourses:u,hasLoadedTeacherCourses:a}=A(m=>m.assignments),{currentSemester:s}=A(m=>m.timetable),[b,r]=p.useState(!1),[n,i]=p.useState(""),[x,g]=p.useState("success");p.useEffect(()=>{s&&s.semesterId!==u&&t(P(s.semesterId))},[t,s,u]),p.useEffect(()=>{u&&!a&&!o&&t(R(u))},[t,u,a,o]),p.useEffect(()=>{c?(i("作业通知已成功发布！"),g("success"),r(!0),t(F())):d&&!l&&(i(`发布失败: ${d}`),g("error"),r(!0))},[c,d,l,t]);const v=async m=>{await t(_(m)).unwrap()},f=(m,S)=>{S!=="clickaway"&&(r(!1),(d||c)&&t(F()))};return e.jsxs(V,{sx:{p:{xs:2,sm:3},minHeight:"70vh"},children:[e.jsxs(y,{variant:"h4",component:"h1",gutterBottom:!0,children:["发布作业/通知 ",s?`(${s.semesterName})`:""]}),o&&!a&&e.jsxs(w,{sx:{display:"flex",justifyContent:"center",my:5},children:[e.jsx(B,{})," ",e.jsx(y,{sx:{ml:2},children:"加载授课列表..."})]}),!o&&!s&&a&&e.jsx($,{severity:"warning",sx:{mt:2},children:"请等待学期信息加载以选择目标课程。"}),a&&!o&&s&&e.jsx(U,{teacherCoursesForDropdown:h,onSubmitAssignment:v,isSubmitting:l,isLoadingCourses:o}),e.jsx(K,{open:b,autoHideDuration:5e3,onClose:f,anchorOrigin:{vertical:"bottom",horizontal:"center"},children:e.jsx($,{onClose:f,severity:x,sx:{width:"100%"},variant:"filled",children:n})})]})};export{re as default};
